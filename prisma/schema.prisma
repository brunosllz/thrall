// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(uuid())
  name         String
  email        String    @unique()
  slug         String    @unique()
  bio          String
  occupation   String
  avatarUrl    String
  city         String
  state        String
  country      String
  linkedinLink String
  githubLink   String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime? @updatedAt

  projects              Project[]
  teamMembers           TeamMember[]
  answers               Answer[]
  answerComments        AnswerComment[]
  projectRoles          ProjectRole[]
  technologies          Technology[]
  sendedNotifications   Notification[]  @relation("Author")
  receivedNotifications Notification[]  @relation("Receiver")
}

model Technology {
  id   String @id @default(uuid())
  slug String @unique()

  project Project[]
  user    User[]
}

enum MEMBER_PERMISSION_TYPE {
  member
  owner
}

enum MEMBER_STATUS {
  pending
  rejected
  approved
}

model TeamMember {
  id             String                 @id @default(uuid())
  recipientId    String
  permissionType MEMBER_PERMISSION_TYPE
  status         MEMBER_STATUS
  projectId      String
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt

  project Project @relation(fields: [projectId], references: [id])
  member  User    @relation(fields: [recipientId], references: [id])
}

enum TIME_IDENTIFIER {
  day
  week
  month
}

model Role {
  id   String @id @default(uuid())
  name String @unique()

  projectRoles ProjectRole[]
}

model ProjectRole {
  id          String @id @default(uuid())
  projectId   String
  roleId      String
  amount      Int
  assigneesId User[]

  project Project @relation(fields: [projectId], references: [id])
  role    Role    @relation(fields: [roleId], references: [id])

  @@unique([projectId, roleId])
}

model Project {
  id String @id @default(uuid())

  authorId                  String
  title                     String
  content                   String
  slug                      String
  requirementTimeAmount     Int
  requirementTimeIdentifier TIME_IDENTIFIER
  requirementContent        String
  createdAt                 DateTime        @default(now())
  updatedAt                 DateTime?       @updatedAt

  teamMembers  TeamMember[]
  answers      Answer[]
  technologies Technology[]
  projectRoles ProjectRole[]

  author User @relation(fields: [authorId], references: [id])

  @@unique([authorId, slug])
}

model Answer {
  id        String    @id @default(uuid())
  content   String
  authorId  String
  projectId String
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  answerComment AnswerComment[]

  project Project @relation(fields: [projectId], references: [id])
  author  User    @relation(fields: [authorId], references: [id])
}

model AnswerComment {
  id        String    @id @default(uuid())
  content   String
  authorId  String
  answerId  String
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  answer Answer @relation(fields: [answerId], references: [id])
  author User   @relation(fields: [authorId], references: [id])
}

model Notification {
  id          String    @id @default(uuid())
  content     String
  authorId    String
  recipientId String
  isRead      DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt

  author   User @relation("Author", fields: [authorId], references: [id])
  receiver User @relation("Receiver", fields: [recipientId], references: [id])
}
